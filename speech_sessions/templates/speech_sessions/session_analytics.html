{% extends 'coach/base.html' %}
{% load static %}

{% block title %}Speech Analytics - Verbal Coach{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <a href="{% url 'speech_sessions:session_list' %}" 
                   class="mr-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-arrow-left text-xl"></i>
                </a>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Speech Analytics</h1>
                    <p class="mt-2 text-sm text-gray-700">
                        Comprehensive analysis of your speech sessions and progress over time.
                    </p>
                </div>
            </div>
            <div>
                <a href="{% url 'speech_sessions:session_create' %}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-plus mr-2"></i>New Session
                </a>
            </div>
        </div>
    </div>

    {% if total_sessions > 0 %}
    <!-- Overview Cards -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-microphone text-indigo-600 text-2xl"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Total Sessions</dt>
                            <dd class="text-2xl font-bold text-gray-900">{{ total_sessions }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-clock text-blue-600 text-2xl"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Total Practice Time</dt>
                            <dd class="text-2xl font-bold text-gray-900">
                                {% if total_duration >= 3600 %}
                                    {{ total_duration|floatformat:0|div:3600 }}h
                                {% else %}
                                    {{ total_duration|floatformat:0|div:60 }}m
                                {% endif %}
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-chart-line text-green-600 text-2xl"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Avg. Duration</dt>
                            <dd class="text-2xl font-bold text-gray-900">{{ avg_duration|floatformat:0|div:60 }}m</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-comment-slash text-yellow-600 text-2xl"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Avg. Filler Rate</dt>
                            <dd class="text-2xl font-bold text-gray-900">{{ avg_fillers|floatformat:1 }}/min</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Analytics -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Progress Chart Placeholder -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Progress Over Time</h3>
                    <div class="bg-gray-50 rounded-lg p-8 text-center">
                        <i class="fas fa-chart-line text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-500">Interactive chart showing your improvement over time</p>
                        <p class="text-sm text-gray-400 mt-2">Chart implementation would go here</p>
                    </div>
                </div>
            </div>

            <!-- Filler Words Analysis -->
            {% if analyzed_sessions_count > 0 %}
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Filler Words Analysis</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-red-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-red-600">{{ total_fillers }}</div>
                            <div class="text-sm text-red-600">Total Filler Words</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-orange-600">{{ avg_fillers|floatformat:1 }}</div>
                            <div class="text-sm text-orange-600">Average per Session</div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-yellow-600">{{ avg_fillers|floatformat:1 }}</div>
                            <div class="text-sm text-yellow-600">Rate per Minute</div>
                        </div>
                    </div>
                    
                    <!-- Improvement Indicator -->
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-lightbulb text-blue-600 mr-2"></i>
                            <div>
                                <h4 class="font-medium text-blue-800">Improvement Tip</h4>
                                <p class="text-sm text-blue-700">
                                    {% if avg_fillers > 5 %}
                                        Focus on pausing instead of using filler words. Practice with deliberate pauses.
                                    {% elif avg_fillers > 2 %}
                                        You're doing well! Try to reduce filler words by being more aware of them during speech.
                                    {% else %}
                                        Excellent control of filler words! Maintain this level of awareness.
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recent Activity -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Recent Activity</h3>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500">Last 30 Days</div>
                                <div class="text-xl font-semibold text-gray-900">{{ recent_sessions_count }} sessions</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-500">This Month</div>
                                <div class="text-xl font-semibold text-gray-900">
                                    {% if recent_sessions_count >= 10 %}
                                        <span class="text-green-600">Very Active</span>
                                    {% elif recent_sessions_count >= 5 %}
                                        <span class="text-blue-600">Active</span>
                                    {% elif recent_sessions_count >= 1 %}
                                        <span class="text-yellow-600">Moderate</span>
                                    {% else %}
                                        <span class="text-gray-600">Inactive</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-8">
            <!-- Session Status Breakdown -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Session Status</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-yellow-400 rounded-full mr-2"></div>
                                <span class="text-sm text-gray-700">Pending</span>
                            </div>
                            <span class="text-sm font-medium text-gray-900">{{ pending_sessions_count }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
                                <span class="text-sm text-gray-700">Analyzed</span>
                            </div>
                            <span class="text-sm font-medium text-gray-900">{{ analyzed_sessions_count }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                                <span class="text-sm text-gray-700">Archived</span>
                            </div>
                            <span class="text-sm font-medium text-gray-900">{{ archived_sessions_count }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goals and Targets -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Goals & Targets</h3>
                    <div class="space-y-4">
                        <!-- Weekly Goal -->
                        <div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">Weekly Sessions</span>
                                <span class="font-medium">{{ recent_sessions_count|div:4|floatformat:0 }}/3</span>
                            </div>
                            <div class="mt-1 bg-gray-200 rounded-full h-2">
                                <div class="bg-indigo-600 h-2 rounded-full" 
                                     style="width: {% widthratio recent_sessions_count|div:4 3 100 %}%"></div>
                            </div>
                        </div>

                        <!-- Filler Word Target -->
                        {% if analyzed_sessions_count > 0 %}
                        <div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">Filler Rate Target</span>
                                <span class="font-medium">{{ avg_fillers|floatformat:1 }}/2.0 per min</span>
                            </div>
                            <div class="mt-1 bg-gray-200 rounded-full h-2">
                                {% if avg_fillers <= 2 %}
                                    <div class="bg-green-600 h-2 rounded-full w-full"></div>
                                {% else %}
                                    <div class="bg-yellow-600 h-2 rounded-full" 
                                         style="width: {% widthratio 2 avg_fillers 100 %}%"></div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <a href="{% url 'speech_sessions:session_create' %}" 
                           class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-plus mr-2"></i>New Session
                        </a>
                        <a href="{% url 'speech_sessions:session_list' %}" 
                           class="w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-list mr-2"></i>View All Sessions
                        </a>
                        <button onclick="exportData()" 
                                class="w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-download mr-2"></i>Export Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Empty State -->
    <div class="text-center py-12">
        <i class="fas fa-chart-bar text-gray-400 text-6xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No analytics data yet</h3>
        <p class="text-gray-500 mb-6">Create your first speech session to start seeing analytics and insights.</p>
        <a href="{% url 'speech_sessions:session_create' %}" 
           class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <i class="fas fa-plus mr-2"></i>Create Your First Session
        </a>
    </div>
    {% endif %}
</div>

<script>
function exportData() {
    // Placeholder for data export functionality
    alert('Data export functionality would be implemented here. This could generate CSV, PDF, or other formats with your speech analytics data.');
}

// Add any chart initialization here
document.addEventListener('DOMContentLoaded', function() {
    // Chart.js or other charting library initialization would go here
    console.log('Analytics page loaded');
});
</script>
{% endblock %}

